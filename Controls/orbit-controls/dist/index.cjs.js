"use strict";var t,e=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(){this.buffers=new WeakMap}initBuffer(t,e,i){let s=0;for(let[r,a]of i.attributes.entries()){let i=a.array,h=t.createBuffer();if(!h)return console.log("Failed to create the buffer object"),-1;t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW);let n=t.getAttribLocation(e,r);n<0||(t.vertexAttribPointer(n,a.itemSize,t.FLOAT,!1,0,0),t.enableVertexAttribArray(n)),i.length&&(s=i.length/a.itemSize),this.buffers.set(a,h)}if(i.index){let e=t.createBuffer();return e?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i.index.array,t.STATIC_DRAW),this.buffers.set(i.index,e),{hasIndex:!0,count:i.index.array.length}):(console.log("Failed to create the buffer object"),-1)}return{hasIndex:!1,count:s}}bindBuffer(t,e,i){t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.buffers.get(i.index));for(let[s,r]of i.attributes.entries()){t.bindBuffer(t.ARRAY_BUFFER,this.buffers.get(r));let i=t.getAttribLocation(e,s);i<0||t.vertexAttribPointer(i,r.itemSize,t.FLOAT,!1,0,0)}}}class s{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.z=i}set(t,e,i){return this.x=t,this.y=e,this.z=i,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}fromArray(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}clone(){return new s(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}crossVectors(t,e){var i=t.x,s=t.y,r=t.z,a=e.x,h=e.y,n=e.z;return this.x=s*n-r*h,this.y=r*a-i*n,this.z=i*h-s*a,this}divideScalar(t){return this.multiplyScalar(1/t)}normalize(){return this.divideScalar(this.length())}applyQuaternion(t){var e=this.x,i=this.y,s=this.z,r=t.x,a=t.y,h=t.z,n=t.w,o=n*e+a*s-h*i,l=n*i+h*e-r*s,u=n*s+r*i-a*e,c=-r*e-a*i-h*s;return this.x=o*n+c*-r+l*-h-u*-a,this.y=l*n+c*-a+u*-r-o*-h,this.z=u*n+c*-h+o*-a-l*-r,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){var s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){var e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}}class r{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,s,r,a,h,n,o,l,u,c,d,m,f,x){var p=this.elements;return p[0]=t,p[4]=e,p[8]=i,p[12]=s,p[1]=r,p[5]=a,p[9]=h,p[13]=n,p[2]=o,p[6]=l,p[10]=u,p[14]=c,p[3]=d,p[7]=m,p[11]=f,p[15]=x,this}copy(t){var e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}multiplyMatrices(t,e){var i=t.elements,s=e.elements,r=this.elements,a=i[0],h=i[4],n=i[8],o=i[12],l=i[1],u=i[5],c=i[9],d=i[13],m=i[2],f=i[6],x=i[10],p=i[14],g=i[3],_=i[7],E=i[11],y=i[15],T=s[0],v=s[4],w=s[8],M=s[12],R=s[1],b=s[5],A=s[9],z=s[13],S=s[2],C=s[6],U=s[10],P=s[14],L=s[3],B=s[7],D=s[11],F=s[15];return r[0]=a*T+h*R+n*S+o*L,r[4]=a*v+h*b+n*C+o*B,r[8]=a*w+h*A+n*U+o*D,r[12]=a*M+h*z+n*P+o*F,r[1]=l*T+u*R+c*S+d*L,r[5]=l*v+u*b+c*C+d*B,r[9]=l*w+u*A+c*U+d*D,r[13]=l*M+u*z+c*P+d*F,r[2]=m*T+f*R+x*S+p*L,r[6]=m*v+f*b+x*C+p*B,r[10]=m*w+f*A+x*U+p*D,r[14]=m*M+f*z+x*P+p*F,r[3]=g*T+_*R+E*S+y*L,r[7]=g*v+_*b+E*C+y*B,r[11]=g*w+_*A+E*U+y*D,r[15]=g*M+_*z+E*P+y*F,this}multiply(t){return this.multiplyMatrices(this,t)}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makePerspective(t,e,i,s,r,a){var h=this.elements,n=2*r/(e-t),o=2*r/(i-s),l=(e+t)/(e-t),u=(i+s)/(i-s),c=-(a+r)/(a-r),d=-2*a*r/(a-r);return h[0]=n,h[4]=0,h[8]=l,h[12]=0,h[1]=0,h[5]=o,h[9]=u,h[13]=0,h[2]=0,h[6]=0,h[10]=c,h[14]=d,h[3]=0,h[7]=0,h[11]=-1,h[15]=0,this}makeOrthographic(t,e,i,s,r,a){var h=this.elements,n=1/(e-t),o=1/(i-s),l=1/(a-r),u=(e+t)*n,c=(i+s)*o,d=(a+r)*l;return h[0]=2*n,h[4]=0,h[8]=0,h[12]=-u,h[1]=0,h[5]=2*o,h[9]=0,h[13]=-c,h[2]=0,h[6]=0,h[10]=-2*l,h[14]=-d,h[3]=0,h[7]=0,h[11]=0,h[15]=1,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}getInverse(t){var e=this.elements,i=t.elements,s=i[0],r=i[1],a=i[2],h=i[3],n=i[4],o=i[5],l=i[6],u=i[7],c=i[8],d=i[9],m=i[10],f=i[11],x=i[12],p=i[13],g=i[14],_=i[15],E=d*g*u-p*m*u+p*l*f-o*g*f-d*l*_+o*m*_,y=x*m*u-c*g*u-x*l*f+n*g*f+c*l*_-n*m*_,T=c*p*u-x*d*u+x*o*f-n*p*f-c*o*_+n*d*_,v=x*d*l-c*p*l-x*o*m+n*p*m+c*o*g-n*d*g,w=s*E+r*y+a*T+h*v;if(0===w){return console.warn("THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0"),this.identity()}var M=1/w;return e[0]=E*M,e[1]=(p*m*h-d*g*h-p*a*f+r*g*f+d*a*_-r*m*_)*M,e[2]=(o*g*h-p*l*h+p*a*u-r*g*u-o*a*_+r*l*_)*M,e[3]=(d*l*h-o*m*h-d*a*u+r*m*u+o*a*f-r*l*f)*M,e[4]=y*M,e[5]=(c*g*h-x*m*h+x*a*f-s*g*f-c*a*_+s*m*_)*M,e[6]=(x*l*h-n*g*h-x*a*u+s*g*u+n*a*_-s*l*_)*M,e[7]=(n*m*h-c*l*h+c*a*u-s*m*u-n*a*f+s*l*f)*M,e[8]=T*M,e[9]=(x*d*h-c*p*h-x*r*f+s*p*f+c*r*_-s*d*_)*M,e[10]=(n*p*h-x*o*h+x*r*u-s*p*u-n*r*_+s*o*_)*M,e[11]=(c*o*h-n*d*h-c*r*u+s*d*u+n*r*f-s*o*f)*M,e[12]=v*M,e[13]=(c*p*a-x*d*a+x*r*m-s*p*m-c*r*g+s*d*g)*M,e[14]=(x*o*a-n*p*a-x*r*l+s*p*l+n*r*g-s*o*g)*M,e[15]=(n*d*a-c*o*a+c*r*l-s*d*l-n*r*m+s*o*m)*M,this}compose(t,e,i){var s=this.elements,r=e._x,a=e._y,h=e._z,n=e._w,o=r+r,l=a+a,u=h+h,c=r*o,d=r*l,m=r*u,f=a*l,x=a*u,p=h*u,g=n*o,_=n*l,E=n*u,y=i.x,T=i.y,v=i.z;return s[0]=(1-(f+p))*y,s[1]=(d+E)*y,s[2]=(m-_)*y,s[3]=0,s[4]=(d-E)*T,s[5]=(1-(c+p))*T,s[6]=(x+g)*T,s[7]=0,s[8]=(m+_)*v,s[9]=(x-g)*v,s[10]=(1-(c+f))*v,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){var a=new s,h=new r,n=this.elements,o=a.set(n[0],n[1],n[2]).length(),l=a.set(n[4],n[5],n[6]).length(),u=a.set(n[8],n[9],n[10]).length();this.determinant()<0&&(o=-o),t.x=n[12],t.y=n[13],t.z=n[14],h.copy(this);var c=1/o,d=1/l,m=1/u;return h.elements[0]*=c,h.elements[1]*=c,h.elements[2]*=c,h.elements[4]*=d,h.elements[5]*=d,h.elements[6]*=d,h.elements[8]*=m,h.elements[9]*=m,h.elements[10]*=m,e.setFromRotationMatrix(h),i.x=o,i.y=l,i.z=u,this}determinant(){var t=this.elements,e=t[0],i=t[4],s=t[8],r=t[12],a=t[1],h=t[5],n=t[9],o=t[13],l=t[2],u=t[6],c=t[10],d=t[14];return t[3]*(+r*n*u-s*o*u-r*h*c+i*o*c+s*h*d-i*n*d)+t[7]*(+e*n*d-e*o*c+r*a*c-s*a*d+s*o*l-r*n*l)+t[11]*(+e*o*u-e*h*d-r*a*u+i*a*d+r*h*l-i*o*l)+t[15]*(-s*h*l-e*n*u+e*h*c+s*a*u-i*a*c+i*n*l)}clone(){return(new r).fromArray(this.elements)}fromArray(t,e=0){for(var i=0;i<16;i++)this.elements[i]=t[i+e];return this}extractRotation(t){var e=new s,i=this.elements,r=t.elements,a=1/e.setFromMatrixColumn(t,0).length(),h=1/e.setFromMatrixColumn(t,1).length(),n=1/e.setFromMatrixColumn(t,2).length();return i[0]=r[0]*a,i[1]=r[1]*a,i[2]=r[2]*a,i[4]=r[4]*h,i[5]=r[5]*h,i[6]=r[6]*h,i[8]=r[8]*n,i[9]=r[9]*n,i[10]=r[10]*n,this}lookAt(t,e,i){var r=new s,a=new s,h=new s,n=this.elements;return h.subVectors(t,e),0===h.lengthSq()&&(h.z=1),h.normalize(),r.crossVectors(i,h),0===r.lengthSq()&&(1===Math.abs(i.z)?h.x+=1e-4:h.z+=1e-4,h.normalize(),r.crossVectors(i,h)),r.normalize(),a.crossVectors(h,r),n[0]=r.x,n[4]=a.x,n[8]=h.x,n[1]=r.y,n[5]=a.y,n[9]=h.y,n[2]=r.z,n[6]=a.z,n[10]=h.z,this}}function a(t=0,e=0,i=0,s=1){this._x=t,this._y=e,this._z=i,this._w=void 0!==s?s:1}var h,n,o;Object.assign(a,{slerp:function(t,e,i,s){return i.copy(t).slerp(e,s)},slerpFlat:function(t,e,i,s,r,a,h){var n=i[s+0],o=i[s+1],l=i[s+2],u=i[s+3],c=r[a+0],d=r[a+1],m=r[a+2],f=r[a+3];if(u!==f||n!==c||o!==d||l!==m){var x=1-h,p=n*c+o*d+l*m+u*f,g=p>=0?1:-1,_=1-p*p;if(_>Number.EPSILON){var E=Math.sqrt(_),y=Math.atan2(E,p*g);x=Math.sin(x*y)/E,h=Math.sin(h*y)/E}var T=h*g;if(n=n*x+c*T,o=o*x+d*T,l=l*x+m*T,u=u*x+f*T,x===1-h){var v=1/Math.sqrt(n*n+o*o+l*l+u*u);n*=v,o*=v,l*=v,u*=v}}t[e]=n,t[e+1]=o,t[e+2]=l,t[e+3]=u}}),Object.defineProperties(a.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this.onChangeCallback()}}}),Object.assign(a.prototype,{set:function(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this.onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=t._x,s=t._y,r=t._z,a=t.order,h=Math.cos,n=Math.sin,o=h(i/2),l=h(s/2),u=h(r/2),c=n(i/2),d=n(s/2),m=n(r/2);return"XYZ"===a?(this._x=c*l*u+o*d*m,this._y=o*d*u-c*l*m,this._z=o*l*m+c*d*u,this._w=o*l*u-c*d*m):"YXZ"===a?(this._x=c*l*u+o*d*m,this._y=o*d*u-c*l*m,this._z=o*l*m-c*d*u,this._w=o*l*u+c*d*m):"ZXY"===a?(this._x=c*l*u-o*d*m,this._y=o*d*u+c*l*m,this._z=o*l*m+c*d*u,this._w=o*l*u-c*d*m):"ZYX"===a?(this._x=c*l*u-o*d*m,this._y=o*d*u+c*l*m,this._z=o*l*m-c*d*u,this._w=o*l*u+c*d*m):"YZX"===a?(this._x=c*l*u+o*d*m,this._y=o*d*u+c*l*m,this._z=o*l*m-c*d*u,this._w=o*l*u-c*d*m):"XZY"===a&&(this._x=c*l*u-o*d*m,this._y=o*d*u-c*l*m,this._z=o*l*m+c*d*u,this._w=o*l*u+c*d*m),!1!==e&&this.onChangeCallback(),this},setFromAxisAngle:function(t,e){var i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(t){var e,i=t.elements,s=i[0],r=i[4],a=i[8],h=i[1],n=i[5],o=i[9],l=i[2],u=i[6],c=i[10],d=s+n+c;return d>0?(e=.5/Math.sqrt(d+1),this._w=.25/e,this._x=(u-o)*e,this._y=(a-l)*e,this._z=(h-r)*e):s>n&&s>c?(e=2*Math.sqrt(1+s-n-c),this._w=(u-o)/e,this._x=.25*e,this._y=(r+h)/e,this._z=(a+l)/e):n>c?(e=2*Math.sqrt(1+n-s-c),this._w=(a-l)/e,this._x=(r+h)/e,this._y=.25*e,this._z=(o+u)/e):(e=2*Math.sqrt(1+c-s-n),this._w=(h-r)/e,this._x=(a+l)/e,this._y=(o+u)/e,this._z=.25*e),this.onChangeCallback(),this},setFromUnitVectors:(n=new s,function(t,e){return void 0===n&&(n=new s),(h=t.dot(e)+1)<1e-6?(h=0,Math.abs(t.x)>Math.abs(t.z)?n.set(-t.y,t.x,0):n.set(0,-t.z,t.y)):n.crossVectors(t,e),this._x=n.x,this._y=n.y,this._z=n.z,this._w=h,this.normalize()}),inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this.onChangeCallback(),this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)},premultiply:function(t){return this.multiplyQuaternions(t,this)},multiplyQuaternions:function(t,e){var i=t._x,s=t._y,r=t._z,a=t._w,h=e._x,n=e._y,o=e._z,l=e._w;return this._x=i*l+a*h+s*o-r*n,this._y=s*l+a*n+r*h-i*o,this._z=r*l+a*o+i*n-s*h,this._w=a*l-i*h-s*n-r*o,this.onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this._x,s=this._y,r=this._z,a=this._w,h=a*t._w+i*t._x+s*t._y+r*t._z;if(h<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,h=-h):this.copy(t),h>=1)return this._w=a,this._x=i,this._y=s,this._z=r,this;var n=Math.sqrt(1-h*h);if(Math.abs(n)<.001)return this._w=.5*(a+this._w),this._x=.5*(i+this._x),this._y=.5*(s+this._y),this._z=.5*(r+this._z),this;var o=Math.atan2(n,h),l=Math.sin((1-e)*o)/n,u=Math.sin(e*o)/n;return this._w=a*l+this._w*u,this._x=i*l+this._x*u,this._y=s*l+this._y*u,this._z=r*l+this._z*u,this.onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this.onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},onChange:function(t){return this.onChangeCallback=t,this},onChangeCallback:function(){}});class l{constructor(){this.changed=!1,this.matrix=new r,this.matrixWorld=new r,this.position=new Proxy(new s,{set:(t,e,i,s)=>{let r=Reflect.set(t,e,i,s);return this.updateMatrixWorld(!0),r}}),this.quaternion=new Proxy(new a,{set:(t,e,i,s)=>{let r=Reflect.set(t,e,i,s);return this.updateMatrixWorld(!0),r}}),this.scale=new Proxy(new s(1,1,1),{set:(t,e,i,s)=>{let r=Reflect.set(t,e,i,s);return this.updateMatrixWorld(!0),r}}),this.parent=null,this.children=[],this.matrixAutoUpdate=!0}applyMatrix(t){this.matrix.multiplyMatrices(t,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)}updateMatrix(){this.changed=!0,this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=this.children,i=0,s=e.length;i<s;i++)e[i].updateMatrixWorld(t)}rotateOnAxis(t,e){var i=new a;return i.setFromAxisAngle(t,e),this.quaternion.multiply(i),this}rotateOnWorldAxis(t,e){var i=new a;return i.setFromAxisAngle(t,e),this.quaternion.premultiply(i),this}rotateX(t){var e=new s(1,0,0);return this.rotateOnAxis(e,t)}rotateY(t){var e=new s(0,1,0);return this.rotateOnAxis(e,t)}rotateZ(t){var e=new s(0,0,1);return this.rotateOnAxis(e,t)}add(t){return t&&(t.parent=this,this.children.push(t)),this}traverse(t){t(this);for(var e=this.children,i=0,s=e.length;i<s;i++)e[i].traverse(t)}}(o=e.RenderSide||(e.RenderSide={}))[o.FRONT=0]="FRONT",o[o.BACK=1]="BACK",o[o.DOUBLE=2]="DOUBLE";class u{constructor(t,e,i){let s=t.createShader(e);return t.shaderSource(s,i),t.compileShader(s),!1===t.getShaderParameter(s,t.COMPILE_STATUS)&&console.error("Shader couldn't compile."),""!==t.getShaderInfoLog(s)&&(console.warn("gl.getShaderInfoLog()",e===t.VERTEX_SHADER?"vertex":"fragment",t.getShaderInfoLog(s)),t.deleteShader(s)),s}}class c{constructor(t){this.gl=t,this.emptyTextures=[],this.emptyTextures[t.TEXTURE_2D]=this.createTexture(t.TEXTURE_2D,t.TEXTURE_2D,1),this.emptyTextures[t.TEXTURE_CUBE_MAP]=this.createTexture(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6)}getEmptyTexture(t){return this.emptyTextures[t]}createTexture(t,e,i){let s=this.gl;var r=new Uint8Array(4),a=s.createTexture();s.bindTexture(t,a),s.texParameteri(t,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(t,s.TEXTURE_MAG_FILTER,s.NEAREST);for(var h=0;h<i;h++)s.texImage2D(e+h,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,r);return a}static getInstance(t){return c.webGL||(c.webGL=new c(t)),c.webGL}}class d{constructor(t){this.unit=0,this.gl=t,this.textureCache=new WeakMap}createTexture(t,e,i){let s=this.gl;t.glTexture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,t.glTexture),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,i,0,s.RGBA,s.UNSIGNED_BYTE,null),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.bindTexture(s.TEXTURE_2D,null)}setTexture2D(t,e){let i=this.gl,s=this.textureCache.get(t),r=this.unit;s||(s={version:0},this.textureCache.set(t,s),this.unit++),t.image&&t.version>0&&s.version!=t.version&&(t.glTexture=t.glTexture?t.glTexture:i.createTexture(),i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_2D,t.glTexture),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),s.version=t.version,i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.image),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1)),i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_2D,t.glTexture||c.getInstance(i).getEmptyTexture(i.TEXTURE_2D))}setTextureCube(t,e){let i=this.gl,s=this.textureCache.get(t),r=this.unit;if(s||(s={version:0},this.textureCache.set(t,s),this.unit++),t.images.length&&t.version>0&&s.version!=t.version){t.glTexture=t.glTexture?t.glTexture:i.createTexture(),i.activeTexture(i.TEXTURE0+this.unit),i.bindTexture(i.TEXTURE_CUBE_MAP,t.glTexture);for(let e=0;e<6;e++){let r=t.images[e];i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,r),s.version=t.version}i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)}i.activeTexture(i.TEXTURE0+r),i.bindTexture(i.TEXTURE_CUBE_MAP,t.glTexture||c.getInstance(i).getEmptyTexture(i.TEXTURE_CUBE_MAP))}}class m{constructor(t,e=1,i=1){if(this.state=new Proxy({needsUpdate:!1,version:0},{set:(t,e,i,s)=>{let r=Reflect.set(t,e,i,s);return"needsUpdate"===e&&!0===i&&this.version++,r}}),this.version=0,this.imageLoadedCount=0,this.image=null,this.images=[],t instanceof Array)this.imageCount=t.length,t.forEach(t=>{let e=new Image;e.onload=()=>{this.loadedCallback(),e.onload=null},e.src=t,this.images.push(e)});else if(t){let e=new Image;e.onload=()=>{this.loadedCallback(),e.onload=null},e.src=t,this.image=e,this.imageCount=1}this.format=e,this.type=i,this.needsUpdate=!1,this.glTexture=null}loadedCallback(){this.imageLoadedCount+=1,this.imageLoadedCount==this.imageCount&&(this.state.needsUpdate=!0)}clone(){return new m(void 0).copy(this)}copy(t){return this.image=t.image,this.format=t.format,this.type=t.type,this}}let f=new m;function x(t,e){t.uniform1f(this.addr,e)}function p(t,e){t.uniform1i(this.addr,e)}function g(t,e){void 0===e.x?t.uniform2fv(this.addr,e):t.uniform2f(this.addr,e.x,e.y)}function _(t,e){void 0!==e.x?t.uniform3f(this.addr,e.x,e.y,e.z):void 0!==e.r?t.uniform3f(this.addr,e.r,e.g,e.b):t.uniform3fv(this.addr,e)}function E(t,e){void 0===e.x?t.uniform4fv(this.addr,e):t.uniform4f(this.addr,e.x,e.y,e.z,e.w)}function y(t,e){t.uniformMatrix2fv(this.addr,!1,e.elements||e)}function T(t,e){t.uniformMatrix3fv(this.addr,!1,e.elements||e)}function v(t,e){t.uniformMatrix4fv(this.addr,!1,e.elements||e)}function w(t,e,i){t.uniform1i(this.addr,i.unit),i.setTexture2D(e||f)}function M(t,e,i){t.uniform1i(this.addr,i.unit),i.setTextureCube(e)}function R(t,e){t.uniform2iv(this.addr,e)}function b(t,e){t.uniform3iv(this.addr,e)}function A(t,e){t.uniform4iv(this.addr,e)}function z(t,e,i){this.id=t,this.addr=i,this.setValue=function(t){switch(t){case 5126:return x;case 35664:return g;case 35665:return _;case 35666:return E;case 35674:return y;case 35675:return T;case 35676:return v;case 35678:return w;case 35680:return M;case 5124:case 35670:return p;case 35667:case 35671:return R;case 35668:case 35672:return b;case 35669:case 35673:return A}}(e.type)}var S,C=[];function U(t,e,i){var s=t[0];if(s<=0||s>0)return t;var r=e*i,a=C[r];if(void 0===a&&(a=new Float32Array(r),C[r]=a),0!==e){s.toArray(a,0);for(var h=1,n=0;h!==e;++h)n+=i,t[h].toArray(a,n)}return a}function P(t,e){t.uniform1fv(this.addr,e)}function L(t,e){t.uniform1iv(this.addr,e)}function B(t,e){t.uniform2fv(this.addr,U(e,this.size,2))}function D(t,e){t.uniform3fv(this.addr,U(e,this.size,3))}function F(t,e){t.uniform4fv(this.addr,U(e,this.size,4))}function I(t,e){t.uniformMatrix2fv(this.addr,!1,U(e,this.size,4))}function O(t,e){t.uniformMatrix3fv(this.addr,!1,U(e,this.size,9))}function X(t,e){t.uniformMatrix4fv(this.addr,!1,U(e,this.size,16))}function G(t,e,i){this.id=t,this.addr=i,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return P;case 35664:return B;case 35665:return D;case 35666:return F;case 35674:return I;case 35675:return O;case 35676:return X;case 5124:case 35670:return L;case 35667:case 35671:return R;case 35668:case 35672:return b;case 35669:case 35673:return A}}(e.type)}class W{constructor(t,e){this.textureManager=new d(t),this.gl=t,this.map={},this.seq=[];for(var i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),s=0;s!==i;++s){var r=t.getActiveUniform(e,s),a=r.name,h=t.getUniformLocation(e,a);this.parseUniform(r,h,this)}}addUniform(t,e){t.seq.push(e),t.map[e.id]=e}parseUniform(t,e,i){var s=/([\w\d_]+)(\])?(\[|\.)?/g,r=t.name,a=r.length;for(s.lastIndex=0;;){var h=s.exec(r),n=s.lastIndex,o=h[1],l="]"===h[2],u=h[3];if(l&&(o+=0),void 0===u||"["===u&&n+2===a){this.addUniform(i,void 0===u?new z(o,t,e):new G(o,t,e));break}i=i.map[o]}}updateUniforms(t={}){this.textureManager.unit=0;let e=this.filterUniforms(Object.keys(t));for(var i=0,s=e.length;i!==s;++i){var r=e[i],a=t[r.id];!1!==a.needsUpdate&&r.setValue(this.gl,a.value,this.textureManager)}}filterUniforms(t){for(var e=[],i=0,s=this.seq.length;i!==s;++i){var r=this.seq[i];-1!=t.indexOf(r.id)&&e.push(r)}return e}}class N{constructor(t,e){this.program=t.createProgram();let i=new u(t,t.VERTEX_SHADER,e.vertexShader),s=new u(t,t.FRAGMENT_SHADER,e.fragmentShader);t.attachShader(this.program,i),t.attachShader(this.program,s),t.linkProgram(this.program);let r=t.getProgramInfoLog(this.program).trim();!1===t.getProgramParameter(this.program,t.LINK_STATUS)?console.error("shader error: ",t.getError(),"gl.VALIDATE_STATUS",t.getProgramParameter(this.program,t.VALIDATE_STATUS),"gl.getProgramInfoLog",r):""!==r&&console.warn("gl.getProgramInfoLog()",r),t.useProgram(this.program),t.deleteShader(i),t.deleteShader(s),this.uniformManager=new W(t,this.program)}}class k{constructor(){this.programCache=new Map}getProgram(t,e){let i=this.getProgramCacheKey(e),s=this.programCache.get(i);return s||(s=new N(t,e),this.programCache.set(i,s)),s}getProgramCacheKey(t){let e=[];return e.push(t.fragmentShader),e.push(t.vertexShader),e.join()}}class q{constructor(t,e){this.min=void 0!==t?t:new s(1/0,1/0,1/0),this.max=void 0!==e?e:new s(-1/0,-1/0,-1/0)}}class V{constructor(){this.attributes=new Map,this.index=null,this.boundingBox=new q}addAttribute(t,e){"index"===t?this.index=e:this.attributes.set(t,e)}}class Y{constructor(t,e=!1){this.itemSize=t,this.normalized=e}setXY(t,e,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,s){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this}}class j extends Y{constructor(t,e,i=!1){super(e,i),t instanceof Float32Array?this.array=t:this.array=new Float32Array(t)}}class Z extends Y{constructor(t,e,i=!1){super(e,i),t instanceof Uint32Array?this.array=t:this.array=new Uint32Array(t)}}class H{constructor(t={},e=!0){this.positions=t.positions||[],this.cells=t.cells||[],this.sameIndex=e,this.vertexUVs=t.vertexUVs,this.faceUVs=t.faceUVs,this.vertexNormals=t.vertexNormals,this.faceNormals=t.faceNormals,this.normalIndices=t.normalIndices}toBufferGeometry(){let t=new V,e=[],i=[],s=[];if(this.sameIndex)t.addAttribute("index",new Z(this.cells.flat(),1)),e=this.positions.flat(),this.vertexNormals&&(i=this.vertexNormals.flat()),this.vertexUVs&&(s=this.vertexUVs.flat());else for(let t=0;t<this.cells.length;t++){if(this.cells[t].forEach(t=>{this.positions[t].forEach(t=>{e.push(t)})}),this.normalIndices){let e=this.normalIndices[t];console.log(e),e.forEach(t=>{this.vertexNormals[t].forEach(t=>{i.push(t)})})}if(this.faceUVs.length){this.faceUVs[t].forEach(t=>{this.vertexUVs[t].forEach(t=>{s.push(t)})})}}return t.addAttribute("position",new j(e,3)),t.addAttribute("normal",new j(i,3)),t.addAttribute("uv",new j(s,2)),t}}class K extends l{constructor(t,i){super(),this.vertexShader="\n        attribute vec4 position;\n        void main () {\n          gl_Position = position;\n        }\n      ",t.fragmentShader&&(this.fragmentShader=t.fragmentShader),t.vertexShader&&(this.vertexShader=t.vertexShader),t.uniforms&&(this.uniforms=t.uniforms),this.transparent=t.transparent||!1,this.side=t.side||e.RenderSide.FRONT,i instanceof H?(this.geometry=i,this.bufferGeometry=this.geometry.toBufferGeometry()):this.bufferGeometry=i,this.programManager=new k}getVertexNum(){return this.vertexNum}getProgram(){return this.glProgram}update(t,e){let i=e||{vertexShader:this.vertexShader,fragmentShader:this.fragmentShader};this.program=this.programManager.getProgram(t,i),this.glProgram=this.program.program,t.useProgram(this.glProgram),this.updateBuffer(t),this.updateUniforms(t)}updateBuffer(t){if(this.bufferManager)this.bufferManager.bindBuffer(t,this.glProgram,this.bufferGeometry);else{this.bufferManager=new i;let e=this.bufferManager.initBuffer(t,this.glProgram,this.bufferGeometry);this.vertexNum=e.count,this.hasIndex=e.hasIndex}}updateUniforms(t){this.program.uniformManager.updateUniforms(this.uniforms)}}class Q extends V{constructor(t=1,e=1,i=1,s=1){super();var r,a,h=t/2,n=e/2,o=Math.floor(i)||1,l=Math.floor(s)||1,u=o+1,c=l+1,d=t/o,m=e/l,f=[],x=[],p=[],g=[];for(a=0;a<c;a++){var _=a*m-n;for(r=0;r<u;r++){var E=r*d-h;x.push(E,-_,0),p.push(0,0,1),g.push(r/o),g.push(1-a/l)}}for(a=0;a<l;a++)for(r=0;r<o;r++){var y=r+u*a,T=r+u*(a+1),v=r+1+u*(a+1),w=r+1+u*a;f.push(y,T,w),f.push(T,v,w)}this.addAttribute("position",new j(x,3)),this.addAttribute("normal",new j(p,3)),this.addAttribute("uv",new j(g,2)),this.addAttribute("index",new Z(f,1))}}class J extends K{constructor(t={},e){super(t=Object.assign({fragmentShader:"void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",uniforms:{}},t),e||new Q(2,2))}}class ${constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}class tt{constructor(t){this.extensions={},this.gl=t,this.get("WEBGL_depth_texture"),this.get("OES_texture_float"),this.get("OES_texture_float_linear"),this.get("OES_texture_half_float"),this.get("OES_texture_half_float_linear"),this.get("OES_standard_derivatives"),this.get("OES_element_index_uint"),this.get("ANGLE_instanced_arrays")}get(t){let e=this.gl;if(void 0!==this.extensions[t])return this.extensions[t];var i;switch(t){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":i=e.getExtension("WEBGL_compressed_texture_etc1");break;default:i=e.getExtension(t)}return null===i&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),this.extensions[t]=i,i}}class et extends l{constructor(){super(),this.up=new s(0,1,0),this.projectionMatrix=new r,this.matrixWorldInverse=new r,this.target=new s}lookTarget(t){t=t||this.target;var e=new r;e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.getInverse(this.matrixWorld)}}class it extends et{constructor(t,e,i,s){super(),this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==s?s:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}updateProjectionMatrix(){var t=this.near,e=t*Math.tan(Math.PI/180*.5*this.fov)/this.zoom,i=2*e,s=this.aspect*i,r=-.5*s,a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+s,e,e-i,t,this.far)}}class st extends V{constructor(){super(),this.addAttribute("position",new j([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,-1,1,1,-1,1,-1,1,1,-1],3)),this.addAttribute("index",new Z([0,3,2,0,2,1,4,0,5,0,1,5,5,1,2,5,2,6,6,2,3,6,3,7,7,3,0,7,0,4,4,5,6,4,6,7],1))}}class rt extends J{constructor(t={},e){super(t=Object.assign({vertexShader:"\n        uniform mat4 mvpMatrix;\n        attribute vec4 position;\n        varying vec4 vTexCoords;\n        void main () {\n          vTexCoords = position;\n          gl_Position = mvpMatrix*position;\n        }\n      ",fragmentShader:"\n        #ifdef GL_ES\n        precision mediump float;\n        #endif\n        uniform samplerCube cube;\n        varying vec4 vTexCoords;\n        void main() {\n          gl_FragColor = textureCube(cube, vTexCoords.xyz);\n        }\n      "},t),e||new st)}}class at{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}add(t){return this.x+=t.x,this.y+=t.y,this}sub(t){return this.x-=t.x,this.y-=t.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}clone(){return new at(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}equals(t){return t.x===this.x&&t.y===this.y}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}}!function(t){t[t.PERSPECTIVE=0]="PERSPECTIVE",t[t.ORTHOGRAPHIC=1]="ORTHOGRAPHIC"}(S||(S={}));class ht{constructor(t,e,i,s={}){this.gl=t,this.textureManager=new d(t),this.width=e,this.height=i,this.texture=new m,this.textureManager.createTexture(this.texture,e,i),this.frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture.glTexture,null),t.bindFramebuffer(t.FRAMEBUFFER,null)}setupDepthTexture(t,e){}clone(){return new ht(this.gl,this.width,this.height).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.texture=t.texture.clone(),this}}e.BufferGeometry=V,e.Clock=$,e.Float32Attribute=j,e.Geometry=H,e.Object3D=l,e.OrthographicCamera=class extends et{constructor(t,e,i,s,r,a){super(),this.zoom=1,this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=void 0!==r?r:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}updateProjectionMatrix(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2,r=i-t,a=i+t,h=s+e,n=s-e;this.projectionMatrix.makeOrthographic(r,a,h,n,this.near,this.far)}},e.PerspectiveCamera=it,e.Quaternion=a,e.RenderFlow=class{constructor(t,e){this.renderer=t;let i={};if(void 0===e){let s=t.getSize();this.pixelRatio=t.getPixelRatio(),this.width=s.x,this.height=s.y,e=new ht(t.gl,this.width*this.pixelRatio,this.height*this.pixelRatio,i)}else this.pixelRatio=1,this.width=e.width,this.height=e.height;this.renderTarget1=e,this.renderTarget2=new ht(t.gl,this.width*this.pixelRatio,this.height*this.pixelRatio,i),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.clock=new $}swapBuffers(){var t=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=t}addPass(t){this.passes.push(t),t.setSize(this.width*this.pixelRatio,this.height*this.pixelRatio)}insertPass(t,e){this.passes.splice(e,0,t)}isLastEnabledPass(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].enabled)return!1;return!0}render(t){void 0===t&&(t=this.clock.getDelta());var e,i,s=this.renderer.getRenderTarget(),r=this.passes.length;for(i=0;i<r;i++)!1!==(e=this.passes[i]).enabled&&(e.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(i),e.render(this.renderer,this.writeBuffer,this.readBuffer,t,!1),e.needsSwap&&this.swapBuffers());this.renderer.setRenderTarget(s)}},e.RenderableElement=K,e.Renderer=class{constructor(t,e={}){if(this.opaqueList=[],this.transparentList=[],this.renderTarget=null,t.element instanceof HTMLCanvasElement)this.canvas=t.element;else{let e;this.canvas=document.createElement("canvas"),t.element instanceof HTMLElement?e=t.element:(e=document.getElementById(t.element),e||console.error(t.element+" not found!")),this.canvas.width=e.clientWidth,this.canvas.height=e.clientHeight,this.width=e.clientWidth,this.height=e.clientHeight,this.setPixelRatio(window.devicePixelRatio);let i=this.canvas.width/this.canvas.height;this.defaultCamera=new it(50,i,.1,1e3),this.defaultCamera.position.z=10,this.cameraMode=t.cameraMode||S.PERSPECTIVE,e.insertBefore(this.canvas,e.firstChild)}this.contextAttributes=Object.assign({alpha:!0,depth:!0,stencil:!0,antialias:!0,premultipliedAlpha:!0,preserveDrawingBuffer:!0},e),this.gl=t.gl||this.canvas.getContext("webgl",this.contextAttributes)||this.canvas.getContext("experimental-webgl",this.contextAttributes),this.contextAttributes.depth&&this.gl.enable(this.gl.DEPTH_TEST),this.programs=new Map,this.extensions=new tt(this.gl),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)}setupMouse(){let t=this.gl,e={x:0,y:0},i={x:0,y:0},s={x:0,y:0},r=(e,i)=>{this.opaqueList.forEach(s=>{t.useProgram(s.glProgram);var r=t.getUniformLocation(s.glProgram,"mouse");null!=r&&t.uniform2f(r,e,i)})};r(0,1);this.canvas.addEventListener("mousemove",t=>{s.x=t.clientX-e.x+i.x,s.y=t.clientY-e.y+i.y,r(s.x/this.canvas.width,1-s.y/this.canvas.height)},!1),this.canvas.addEventListener("mouseover",t=>{e.x=t.clientX,e.y=t.clientY},!1),this.canvas.addEventListener("mouseout",t=>{i.x=s.x,i.y=s.y},!1)}setRenderTarget(t){t?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,t.frameBuffer),this.renderTarget=t):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.renderTarget=null)}renderElement(t,i,s){let a,h=this.gl,n=new r;if(t instanceof J?h.disable(h.DEPTH_TEST):(h.enable(h.DEPTH_TEST),n.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse)),t.update(h,s),t instanceof rt){let e=new r;e.extractRotation(i.matrixWorld),e.getInverse(e),a=new r,a.multiplyMatrices(i.projectionMatrix,e),a.multiply(t.matrixWorld)}else a=n.clone(),a.multiply(t.matrixWorld);var o=h.getUniformLocation(t.glProgram,"mvpMatrix");switch(null!=o&&h.uniformMatrix4fv(o,!1,a.elements),t.side){case e.RenderSide.FRONT:h.enable(h.CULL_FACE),h.cullFace(h.BACK);break;case e.RenderSide.BACK:h.enable(h.CULL_FACE),h.cullFace(h.FRONT);break;case e.RenderSide.DOUBLE:h.disable(h.CULL_FACE)}t.hasIndex?h.drawElements(h.TRIANGLES,t.vertexNum,h.UNSIGNED_INT,0):h.drawArrays(h.TRIANGLES,0,t.vertexNum)}getRenderTarget(){return this.renderTarget}setPixelRatio(t){void 0!==t&&(this.pixelRatio=t,this.setSize(this.width,this.height,!1))}getPixelRatio(){return this.pixelRatio}setSize(t,e,i){this.width=t,this.height=e,this.canvas.width=Math.floor(t*this.pixelRatio),this.canvas.height=Math.floor(e*this.pixelRatio),this.canvas.style.width=t+"px",this.canvas.style.height=e+"px"}getSize(){return new at(this.width,this.height)}render(t,e,i,s=!1){let r=this.gl;r.clearColor(0,0,0,0);let a=()=>{this.opaqueList=[],this.transparentList=[],t&&this.opaqueList.push(t),e&&e.traverse(t=>{t instanceof K&&(t.transparent?this.transparentList.push(t):this.opaqueList.push(t))}),i=i||this.defaultCamera,r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),this.opaqueList.forEach(t=>{this.renderElement(t,i)}),this.transparentList.forEach(t=>{this.renderElement(t,i)}),s||requestAnimationFrame(a)};a()}},e.SkyBox=rt,e.Texture=m,e.Uint32Attribute=Z,e.Vector2=at,e.Vector3=s}));(t=e)&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")&&t.default;e.RenderSide,e.BufferGeometry,e.Clock,e.Float32Attribute,e.Geometry,e.Object3D,e.OrthographicCamera,e.PerspectiveCamera;var i=e.Quaternion,s=(e.RenderFlow,e.RenderableElement,e.Renderer,e.SkyBox,e.Texture,e.Uint32Attribute,e.Vector2),r=e.Vector3;function a(t=1,e=0,i=0){this.radius=t,this.phi=e,this.theta=i}Object.assign(a.prototype,{set:function(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,i){var s,r,a;return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos((s=e/this.radius,r=-1,a=1,Math.max(r,Math.min(a,s))))),this}});let h=0,n=1,o=2,l=-1,u=0,c=1;module.exports=class{constructor(t,e){this.camera=t,this.domElement=e,this.enabled=!0,this.target=new r,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!0,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=.3,this.autoRotate=!1,this.autoRotateSpeed=2,this.mouseButtons={LEFT:h,MIDDLE:n,RIGHT:o},this.state=l,this.spherical=new a,this.sphericalDelta=new a,this.scale=1,this.panOffset=new r,this.zoomChanged=!1,this.rotateStart=new s,this.rotateEnd=new s,this.rotateDelta=new s,this.dollyStart=new s,this.dollyEnd=new s,this.dollyDelta=new s,this.offset=new r,this.quat=(new i).setFromUnitVectors(this.camera.up,new r(0,1,0)),this.quatInverse=this.quat.clone().inverse(),this.lastPosition=new r,this.lastQuaternion=new i,this.onMouseDown=t=>{if(!1!==this.enabled){switch(t.preventDefault(),t.button){case 0:switch(this.mouseButtons.LEFT){case h:if(t.ctrlKey||t.metaKey||t.shiftKey);else{if(!1===this.enableRotate)return;this.handleMouseDownRotate(t),this.state=u}break;default:this.state=l}break;case 1:switch(this.mouseButtons.MIDDLE){case n:if(!1===this.enableZoom)return;this.handleMouseDownDolly(t),this.state=c;break;default:this.state=l}break;case 2:switch(this.mouseButtons.RIGHT){case h:if(!1===this.enableRotate)return;this.handleMouseDownRotate(t),this.state=u;break;default:this.state=l}}this.state!==l&&(document.addEventListener("mousemove",this.onMouseMove,!1),document.addEventListener("mouseup",this.onMouseUp,!1))}},this.onMouseMove=t=>{if(!1!==this.enabled)switch(t.preventDefault(),this.state){case u:if(!1===this.enableRotate)return;this.handleMouseMoveRotate(t);break;case c:if(!1===this.enableZoom)return;this.handleMouseMoveDolly(t)}},this.onMouseUp=t=>{!1!==this.enabled&&(document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),this.state=l)},this.onMouseWheel=t=>{!1===this.enabled||!1===this.enableZoom||this.state!==l&&this.state!==u||(t.preventDefault(),t.stopPropagation(),this.handleMouseWheel(t))},this.domElement.addEventListener("mousedown",this.onMouseDown,!1),this.domElement.addEventListener("wheel",this.onMouseWheel,!1)}handleMouseDownRotate(t){this.rotateStart.set(t.clientX,t.clientY)}handleMouseDownDolly(t){this.dollyStart.set(t.clientX,t.clientY)}handleMouseMoveRotate(t){this.rotateEnd.set(t.clientX,t.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart).multiplyScalar(this.rotateSpeed);var e=this.domElement;this.rotateLeft(2*Math.PI*this.rotateDelta.x/e.clientHeight),this.rotateUp(2*Math.PI*this.rotateDelta.y/e.clientHeight),this.rotateStart.copy(this.rotateEnd)}handleMouseMoveDolly(t){this.dollyEnd.set(t.clientX,t.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyIn(this.getZoomScale()):this.dollyDelta.y<0&&this.dollyOut(this.getZoomScale()),this.dollyStart.copy(this.dollyEnd)}handleMouseWheel(t){t.deltaY<0?this.dollyOut(this.getZoomScale()):t.deltaY>0&&this.dollyIn(this.getZoomScale()),this.update()}rotateLeft(t){this.sphericalDelta.theta-=t}rotateUp(t){this.sphericalDelta.phi-=t}dollyIn(t){this.camera.isPerspective?this.scale/=t:this.camera.isOrthographic?(this.camera.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.camera.zoom*t)),this.camera.updateProjectionMatrix(),this.zoomChanged=!0):this.enableZoom=!1}dollyOut(t){this.camera.isPerspective?this.scale*=t:this.camera.isOrthographic?(this.camera.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.camera.zoom/t)),this.camera.updateProjectionMatrix(),this.zoomChanged=!0):this.enableZoom=!1}getAutoRotationAngle(){return 2*Math.PI/60/60*this.autoRotateSpeed}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}update(){var t=this.camera.position;return this.offset.copy(t).sub(this.target),this.offset.applyQuaternion(this.quat),this.spherical.setFromVector3(this.offset),this.autoRotate&&this.state===l&&this.rotateLeft(this.getAutoRotationAngle()),this.enableDamping?(this.spherical.theta+=this.sphericalDelta.theta*this.dampingFactor,this.spherical.phi+=this.sphericalDelta.phi*this.dampingFactor):(this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi),this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),!0===this.enableDamping?this.target.addScaledVector(this.panOffset,this.dampingFactor):this.target.add(this.panOffset),this.offset.setFromSpherical(this.spherical),this.offset.applyQuaternion(this.quatInverse),t.copy(this.target).add(this.offset),this.camera.lookTarget(this.target),!0===this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor,this.panOffset.multiplyScalar(1-this.dampingFactor)):(this.sphericalDelta.set(0,0,0),this.panOffset.set(0,0,0)),this.scale=1,!!(this.zoomChanged||this.lastPosition.distanceToSquared(this.camera.position)>1e-6||8*(1-this.lastQuaternion.dot(this.camera.quaternion))>1e-6)&&(this.lastPosition.copy(this.camera.position),this.lastQuaternion.copy(this.camera.quaternion),this.zoomChanged=!1,!0)}};
//# sourceMappingURL=index.cjs.js.map
